# Project: adams
# Date: 2020-07-22 08:54:24
# User: fracpete
# Charset: UTF-8
# Modules: adams-audio,adams-core,adams-event,adams-ffmpeg,adams-meta,adams-net,adams-rats-core,adams-spreadsheet,adams-terminal,adams-ufdl-core,adams-ufdl-speech
#
adams.flow.control.Flow -annotation "Flow for managing speech datasets (create/update/view/download/delete).\\nUses host/user/password from the global UFDL Preferences." -error-handling ACTORS_DECIDE_TO_STOP_ON_ERROR -flow-execution-listener adams.flow.execution.NullListener -flow-restart-manager adams.flow.control.flowrestart.NullManager
 adams.flow.standalone.CallableActors
  adams.flow.sink.Display -name Info -short-title true -display-type adams.flow.core.displaytype.Default -writer adams.data.io.output.NullWriter
  adams.flow.sink.HistoryDisplay -name Errors -short-title true -display-type adams.flow.core.displaytype.Default -y -3
  adams.flow.sink.Display -name Transcript -short-title true -display-type adams.flow.core.displaytype.Default -width 400 -height 200 -x -2 -y -2 -writer adams.data.io.output.NullWriter -line-wrap true -wrap-style-word true
  adams.flow.sink.ProgressBar -display-type adams.flow.core.displaytype.Default -writer adams.gui.print.NullWriter -max @{max}
  adams.flow.sink.SpreadSheetDisplay -name Current -short-title true -display-type adams.flow.core.displaytype.Default -x -3 -cell-rendering-customizer adams.gui.core.spreadsheettable.DefaultCellRenderingCustomizer -allow-search true -writer adams.data.io.output.NullWriter
  adams.flow.control.Tee -name "clear output"
   adams.flow.control.ClearCallableDisplay -name "clear info" -callable Info
   adams.flow.control.CloseCallableDisplay -name "close info" -callable Info
   adams.flow.control.ClearCallableDisplay -name "clear errors" -callable Errors
   adams.flow.control.CloseCallableDisplay -name "close errors" -callable Errors
   adams.flow.control.ClearCallableDisplay -name "clear transcript" -callable Transcript
   adams.flow.control.CloseCallableDisplay -name "close transcript" -callable Transcript
   adams.flow.control.CloseCallableDisplay -name "close progressbar" -callable ProgressBar
   adams.flow.control.CloseCallableDisplay -name "close current" -callable Current
  adams.flow.control.Trigger -name "add files" -annotation "adds files to dataset \\\"dataset\\\" from storage"
   adams.flow.source.Start
   adams.flow.control.Trigger -name "prompt user"
    adams.flow.standalone.SetVariable -name "restore file" -var-name restore -var-value @{flow_filename_long}-add_files.props -value-type FILE_FORWARD_SLASHES -expand-value true
    adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
    adams.flow.source.EnterManyValues -name "Add files" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name input_dir -display \"Dir with sound files (wav/mp3)\" -type DIRECTORY_ABSOLUTE -default-value . -use-forward-slashes true" -value "adams.flow.source.valuedefinition.ListSelectionValueDefinition -name transcript_file_type -display \"File type of transcripts\" -value CSV -value TSV -default-value TSV" -value "adams.flow.source.valuedefinition.FileValueDefinition -name transcripts_csv -display \"CSV file with transcripts\" -help \"comma-separated file\" -file-chooser-title \"Select CSV file with transcripts\" -extension csv -use-forward-slashes true" -value "adams.flow.source.valuedefinition.FileValueDefinition -name transcripts_tsv -display \"TSV file with transcripts\" -help \"tab separated file (as used by common-voice)\" -file-chooser-title \"Select TSV file with transcripts\" -extension tsv -use-forward-slashes true" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name col_filename -display \"Column in spreadsheet with filename\" -type INDEX -default-value 1" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name col_transcript -display \"Column in spreadsheet with transcript\" -type INDEX -default-value 2" -output-type MAP -restoration-enabled true -restoration-file @{restore}
    adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
    adams.flow.transformer.MapToVariables
   adams.flow.control.Block -name "block if cancelled" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
   adams.flow.control.Trigger -name "load transcripts"
    adams.flow.source.Variable -var-name transcript_file_type -conversion adams.data.conversion.StringToString
    adams.flow.control.Switch -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"X\\\\\\\" = \\\\\\\"CSV\\\\\\\"\"" -condition "adams.flow.condition.bool.Expression -expression \"\\\\\\\"X\\\\\\\" = \\\\\\\"TSV\\\\\\\"\"" -condition adams.flow.condition.bool.True
     adams.flow.control.Trigger -name "load csv"
      adams.flow.source.Variable -var-name transcripts_csv -conversion adams.data.conversion.StringToString
      adams.flow.transformer.SpreadSheetFileReader -reader "adams.data.io.input.CsvSpreadSheetReader -data-row-type adams.data.spreadsheet.DenseDataRow -spreadsheet-type adams.data.spreadsheet.DefaultSpreadSheet -parse-formulas false"
      adams.flow.transformer.LookUpInit -storage-name transcripts -key-column @{col_filename} -value-column @{col_transcript}
     adams.flow.control.Trigger -name "load tsv"
      adams.flow.source.Variable -var-name transcripts_tsv -conversion adams.data.conversion.StringToString
      adams.flow.transformer.SpreadSheetFileReader -reader "adams.data.io.input.CsvSpreadSheetReader -data-row-type adams.data.spreadsheet.DenseDataRow -spreadsheet-type adams.data.spreadsheet.DefaultSpreadSheet -separator \\t -parse-formulas false"
      adams.flow.transformer.LookUpInit -storage-name transcripts -key-column @{col_filename} -value-column @{col_transcript}
     adams.flow.control.Stop -stop-msg "Unknown transcript file type: @{transcript_file_type}"
   adams.flow.control.Trigger -name "iterate files"
    adams.flow.standalone.SetVariable -name reset -var-name count -var-value 0
    adams.flow.source.FileSystemSearch -output-array true -search "adams.flow.source.filesystemsearch.LocalFileSearch -directory @{input_dir} -regexp .*\\\\.(mp3|MP3|wav|WAV) -sorting SORT_BY_NAME" -use-forward-slashes true
    adams.flow.control.Tee -name "# files"
     adams.flow.transformer.ArrayLength
     adams.flow.transformer.SetVariable -var-name max
    adams.flow.transformer.ArrayToSequence
    adams.flow.control.Tee -name progress
     adams.flow.transformer.IncVariable -var-name count -output-variable-value true
     adams.flow.sink.CallableSink -callable ProgressBar
    adams.flow.transformer.SetVariable -var-name file
    adams.flow.control.Tee -name "get transcript"
     adams.flow.transformer.SetVariable -name reset -var-name no_transcript -var-value true
     adams.flow.transformer.BaseName
     adams.flow.transformer.LookUp -storage-name transcripts -suppress-missing-key-warnings true
     adams.flow.transformer.SetVariable -var-name transcript
     adams.flow.transformer.SetVariable -name set -var-name no_transcript -var-value false
    adams.flow.control.Block -condition "adams.flow.condition.bool.VariableFlagSet -variable-name no_transcript"
    adams.flow.control.Trigger -name "add file"
     adams.flow.source.StorageValue -storage-name dataset -conversion adams.data.conversion.UnknownToUnknown
     adams.flow.transformer.UFDLTransformer -action "adams.flow.transformer.ufdl.AddSpeechFile -file @{file} -transcript @{transcript}" -use-error-queue true
    adams.flow.control.Trigger -name info
     adams.flow.source.CombineVariables -expression "added: @{file}\\n  @{transcript}" -conversion adams.data.conversion.StringToString
     adams.flow.sink.CallableSink -callable Info
 adams.flow.standalone.UFDLConnection
 adams.flow.standalone.SetVariable -name initialize -var-name show_main_menu -var-value true
 adams.flow.standalone.QueueInit -storage-name errors
 adams.flow.standalone.SetVariable -name "log file" -var-name logfile -var-value @{flow_filename_long}.log -value-type FILE_FORWARD_SLASHES -expand-value true
 adams.flow.standalone.Rats
  adams.flow.standalone.Rat -name "error queue" -receiver "adams.flow.standalone.rats.input.DeQueue -storage-name errors" -transmitter adams.flow.standalone.rats.output.DummyOutput -log-generator adams.flow.standalone.rats.log.LogEntryGenerator -scope-handling-variables COPY -scope-handling-storage SHARE
   adams.flow.control.Tee -name "get error"
    adams.flow.transformer.Convert -conversion adams.data.conversion.TextContainerToString
    adams.flow.transformer.StringIndent -indentation " " -num-times 4
    adams.flow.transformer.SetVariable -var-name error
   adams.flow.control.Tee -name "get actor"
    adams.flow.transformer.GetReportValue -field Actor[S]
    adams.flow.transformer.SetVariable -var-name actor
   adams.flow.control.Tee -name "get action"
    adams.flow.transformer.GetReportValue -field Action[S]
    adams.flow.transformer.SetVariable -var-name action
   adams.flow.control.Tee -name "get timestamp"
    adams.flow.transformer.GetReportValue -field Timestamp[S]
    adams.flow.transformer.SetVariable -var-name timestamp
   adams.flow.control.Trigger -name "add to log file"
    adams.flow.source.CombineVariables -expression "\\n@{timestamp}\\n  actor: @{actor}\\n  action: @{action}\\n  error: \\n@{error}" -conversion adams.data.conversion.StringToString
    adams.flow.sink.DumpFile -output @{logfile} -append true
   adams.flow.control.Trigger -name "display error"
    adams.flow.source.CombineVariables -expression "@{timestamp}\\n  actor: @{actor}\\n  action: @{action}\\n  error: \\n@{error}" -conversion adams.data.conversion.StringToString
    adams.flow.sink.CallableSink -callable Errors
 adams.flow.source.Start
 adams.flow.control.WhileLoop -name menu -condition "adams.flow.condition.bool.VariableFlagSet -variable-name show_main_menu"
  adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
  adams.flow.source.Start
  adams.flow.control.CloseCallableDisplay -name "close progressbar" -callable ProgressBar
  adams.flow.control.Trigger -name "menu prompt"
   adams.flow.source.EnterValue -name "Speech modelling" -message "Please select dataset operation" -selection-values List -selection-values Create -selection-values Update -selection-values View -selection-values Download -selection-values Delete -selection-values Reinstate -selection-values "Clear output" -selection-values Exit -use-buttons true -vertical-buttons true
   adams.flow.transformer.SetVariable -var-name choice
   adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
  adams.flow.control.Block -name "block if cancelled" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
  adams.flow.control.Switch -name "menu actions" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value List" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value Create" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value Update" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value View" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value Download" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value Delete" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value Reinstate" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value \"Clear output\"" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value Exit" -lenient true
   adams.flow.control.Trigger -name List
    adams.flow.standalone.SetVariable -name reset -var-name no_datasets -var-value true
    adams.flow.source.Start
    adams.flow.control.Trigger -name display
     adams.flow.source.UFDLSource -action "adams.flow.source.ufdl.ListSpeechDatasets -resolve-ids true" -use-error-queue true
     adams.flow.transformer.SetVariable -var-name no_datasets -var-value false
     adams.flow.sink.CallableSink -callable Current
    adams.flow.control.ConditionalTrigger -name "no datasets?" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name no_datasets"
     adams.flow.source.CombineVariables -expression "No datasets to list!" -conversion adams.data.conversion.StringToString
     adams.flow.sink.InformationDialog
   adams.flow.control.Trigger -name Create
    adams.flow.source.Start
    adams.flow.control.Trigger -name current
     adams.flow.source.UFDLSource -action "adams.flow.source.ufdl.ListSpeechDatasets -state ANY -resolve-ids true" -use-error-queue true
     adams.flow.sink.CallableSink -callable Current
    adams.flow.control.Trigger -name "prompt user"
     adams.flow.standalone.SetVariable -name "restore file" -var-name restore -var-value @{flow_filename_long}-create.props -value-type FILE_FORWARD_SLASHES -expand-value true
     adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
     adams.flow.source.EnterManyValues -name "Create dataset" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name dataset_name -display Name" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name dataset_description -display Description" -value "adams.flow.source.valuedefinition.UFDLProjectList -name dataset_project -display Project" -value "adams.flow.source.valuedefinition.UFDLLicenseList -name dataset_license -display License" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name dataset_public -display \"Public dataset?\" -type BOOLEAN -default-value false" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name dataset_tags -display Tags" -output-type MAP -restoration-enabled true -restoration-file @{restore}
     adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
     adams.flow.transformer.MapToVariables
     adams.flow.transformer.UFDLExtractAndTransfer -name project_pk -source dataset_project -target project_pk
     adams.flow.transformer.UFDLExtractAndTransfer -name license_pk -source dataset_license -target license_pk
    adams.flow.control.CloseCallableDisplay -callable Current
    adams.flow.control.Block -name "block if cancelled" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
    adams.flow.control.Trigger -name create
     adams.flow.standalone.SetVariable -name reset -var-name created -var-value false
     adams.flow.source.UFDLSource -action "adams.flow.source.ufdl.CreateSpeechDataset -name @{dataset_name} -description @{dataset_description} -project @{project_pk} -license @{license_pk} -is-public @{dataset_public} -tags @{dataset_tags}" -use-error-queue true
     adams.flow.transformer.SetVariable -name set -var-name created -var-value true
     adams.flow.transformer.SetStorageValue -storage-name dataset
     adams.flow.sink.CallableSink -callable Info
    adams.flow.control.Block -name "block if not created" -condition "adams.flow.condition.bool.Not -condition \"adams.flow.condition.bool.VariableFlagSet -variable-name created\""
    adams.flow.transformer.CallableTransformer -callable "add files"
   adams.flow.control.Trigger -name Update
    adams.flow.standalone.SetVariable -name initialize -var-name show_update_menu -var-value true
    adams.flow.source.Start
    adams.flow.control.Trigger -name "prompt user"
     adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
     adams.flow.standalone.SetVariable -name "restore file" -var-name restore -var-value @{flow_filename_long}-update.props -value-type FILE_FORWARD_SLASHES -expand-value true
     adams.flow.source.EnterManyValues -name "Update dataset" -stop-if-canceled true -value "adams.flow.source.valuedefinition.UFDLSpeechDatasetList -name dataset -display Dataset" -output-type MAP -restoration-enabled true -restoration-file @{restore}
     adams.flow.transformer.MapToVariables
     adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
     adams.flow.transformer.UFDLExtractAndTransfer -name dataset_pk -source dataset -target dataset_pk
    adams.flow.control.Block -name "Block if cancelled" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
    adams.flow.control.WhileLoop -name "update menu" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name show_update_menu"
     adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
     adams.flow.source.Start
     adams.flow.control.CloseCallableDisplay -name "close progressbar" -callable ProgressBar
     adams.flow.control.Trigger -name "menu prompt"
      adams.flow.source.EnterValue -name "Update menu" -message "Please select update operation" -selection-values Properties -selection-values "Add files" -selection-values "Update files" -selection-values "Delete files" -selection-values "Clear output" -selection-values Return -use-buttons true -vertical-buttons true
      adams.flow.transformer.SetVariable -var-name choice
      adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
     adams.flow.control.Block -name "block if cancelled" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
     adams.flow.control.Switch -name "menu actions" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value Properties" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value \"Add files\"" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value \"Update files\"" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value \"Delete files\"" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value \"Clear output\"" -condition "adams.flow.condition.bool.HasVariableValue -variable-name choice -value Return" -lenient true
      adams.flow.control.Trigger -name Properties
       adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
       adams.flow.transformer.UFDLTransformer -action adams.flow.transformer.ufdl.LoadSpeechDataset -use-error-queue true
       adams.flow.transformer.SetStorageValue -storage-name dataset
       adams.flow.transformer.Convert -conversion adams.data.conversion.UFDLSpeechDatasetToSpreadSheet
       adams.flow.transformer.SpreadSheetVariableRowIterator
       adams.flow.control.Trigger -name license
        adams.flow.source.Variable -var-name license -conversion adams.data.conversion.StringToInt
        adams.flow.transformer.UFDLTransformer -action adams.flow.transformer.ufdl.LoadLicense -use-error-queue true
        adams.flow.transformer.Convert -conversion adams.data.conversion.UFDLLicenseToListItem
        adams.flow.transformer.SetVariable -var-name license
       adams.flow.control.Trigger -name project
        adams.flow.source.Variable -var-name project -conversion adams.data.conversion.StringToInt
        adams.flow.transformer.UFDLTransformer -action adams.flow.transformer.ufdl.LoadProject -use-error-queue true
        adams.flow.transformer.Convert -conversion adams.data.conversion.UFDLProjectToListItem
        adams.flow.transformer.SetVariable -var-name project
       adams.flow.control.Trigger -name "prompt user"
        adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
        adams.flow.source.EnterManyValues -name "Update properties" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name dataset_name -display \"Dataset name\" -default-value @{name}" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name dataset_desc -display Description -default-value @{description}" -value "adams.flow.source.valuedefinition.UFDLLicenseList -name dataset_license -display License -default-value @{license}" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name dataset_public -display Public? -type BOOLEAN -default-value @{name}" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name dataset_tags -display Tags -default-value @{tags}" -value "adams.flow.source.valuedefinition.UFDLProjectList -name dataset_project -display Project -default-value @{project}" -output-type MAP
        adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
        adams.flow.transformer.MapToVariables
        adams.flow.transformer.UFDLExtractAndTransfer -name project_pk -source dataset_project -target project_pk
        adams.flow.transformer.UFDLExtractAndTransfer -name license_pk -source dataset_license -target license_pk
       adams.flow.control.Block -name "Block if cancelled" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
       adams.flow.control.Trigger -name update
        adams.flow.source.StorageValue -storage-name dataset -conversion adams.data.conversion.UnknownToUnknown
        adams.flow.transformer.UFDLTransformer -action "adams.flow.transformer.ufdl.UpdateSpeechDataset -name @{dataset_name} -description @{dataset_desc} -project @{project_pk} -license @{license_pk} -is-public @{dataset_public} -tags @{dataset_tags}" -use-error-queue true
        adams.flow.sink.CallableSink -callable Info
      adams.flow.control.Trigger -name "Add files"
       adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
       adams.flow.transformer.SetStorageValue -storage-name dataset
       adams.flow.transformer.CallableTransformer -callable "add files"
      adams.flow.control.Trigger -name "Update files"
       adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
       adams.flow.transformer.UFDLTransformer -action adams.flow.transformer.ufdl.ListSpeechFiles -use-error-queue true
       adams.flow.transformer.SpreadSheetSelectSubset -message "Please select files to delete" -allow-search true
       adams.flow.control.Tee -name "# files"
        adams.flow.transformer.SpreadSheetInfo
        adams.flow.transformer.SetVariable -var-name num_images
       adams.flow.control.ConditionalTee -name "update files?" -condition "adams.flow.condition.bool.PromptUser -message \"Do you want to update @{num_files} file(s)?\""
        adams.flow.transformer.SpreadSheetVariableRowIterator -columns file
        adams.flow.control.Trigger -name "get current transcript"
         adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
         adams.flow.transformer.UFDLTransformer -action "adams.flow.transformer.ufdl.GetSpeechTranscriptForFile -name @{file}" -use-error-queue true
         adams.flow.transformer.SetVariable -var-name transcript
        adams.flow.control.Trigger -name "enter new transcript"
         adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
         adams.flow.source.EnterValue -message "Please enter new transcript" -initial-value @{transcript} -num-cols 40 -num-rows 3
         adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
         adams.flow.transformer.SetVariable -var-name transcript_new
        adams.flow.control.Block -name "block if cancelled" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
        adams.flow.control.Trigger -name "update transcript"
         adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
         adams.flow.transformer.UFDLTransformer -action "adams.flow.transformer.ufdl.SetSpeechTranscriptForFile -name @{file} -transcript @{transcript_new}" -use-error-queue true
         adams.flow.control.Trigger -name info
          adams.flow.source.CombineVariables -expression "Updated @{file}:\\n- old\\n  @{transcript}\\n- new\\n  @{transcript_new}" -conversion adams.data.conversion.StringToString
          adams.flow.sink.CallableSink -callable Info
      adams.flow.control.Trigger -name "Delete files"
       adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
       adams.flow.transformer.UFDLTransformer -action adams.flow.transformer.ufdl.ListSpeechFiles -use-error-queue true
       adams.flow.transformer.SpreadSheetSelectSubset -message "Please select files to delete" -allow-search true
       adams.flow.control.Tee -name "# files"
        adams.flow.transformer.SpreadSheetInfo
        adams.flow.transformer.SetVariable -var-name num_images
       adams.flow.control.ConditionalTee -name "delete files?" -condition "adams.flow.condition.bool.PromptUser -message \"Do you want to delete @{num_images} file(s)?\""
        adams.flow.transformer.SpreadSheetVariableRowIterator -columns file
        adams.flow.control.Trigger -name "delete file"
         adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
         adams.flow.transformer.UFDLTransformer -action "adams.flow.transformer.ufdl.DeleteSpeechFile -name @{file}" -use-error-queue true
         adams.flow.transformer.SetVariable -var-name success
         adams.flow.control.Trigger -name "output success"
          adams.flow.source.CombineVariables -expression "@{file}: @{success}" -conversion adams.data.conversion.StringToString
          adams.flow.transformer.StringInsert -position first -value "deleted (@{dataset_pk}): " -variable true
          adams.flow.sink.CallableSink -callable Info
      adams.flow.control.Tee -name "Clear output"
       adams.flow.transformer.CallableTransformer -callable "clear output"
      adams.flow.control.Trigger -name Return
       adams.flow.standalone.SetVariable -var-name show_update_menu -var-value false
   adams.flow.control.Trigger -name View
    adams.flow.source.EnterManyValues -name "View dataset" -value "adams.flow.source.valuedefinition.UFDLSpeechDatasetList -name dataset -display Dataset" -output-type MAP
    adams.flow.transformer.MapToVariables
    adams.flow.transformer.UFDLExtractAndTransfer -name dataset_pk -source dataset -target dataset_pk
    adams.flow.control.Trigger -name view
     adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
     adams.flow.transformer.UFDLTransformer -action adams.flow.transformer.ufdl.ListSpeechFiles -use-error-queue true
     adams.flow.transformer.SetStorageValue -storage-name files
     adams.flow.transformer.SetVariable -var-name show_files -var-value true
     adams.flow.control.WhileLoop -condition "adams.flow.condition.bool.VariableFlagSet -variable-name show_files"
      adams.flow.standalone.SetVariable -name "reset count" -var-name count -var-value 0
      adams.flow.source.StorageValue -storage-name files -conversion adams.data.conversion.UnknownToUnknown
      adams.flow.transformer.SetVariable -name reset -var-name show_files -var-value false
      adams.flow.transformer.SpreadSheetSelectSubset -message "Please select files to play back (cancel to exit)" -allow-search true
      adams.flow.control.Tee -name "# files"
       adams.flow.transformer.SpreadSheetInfo
       adams.flow.transformer.SetVariable -var-name max
      adams.flow.transformer.SetVariable -name set -var-name show_files -var-value true
      adams.flow.transformer.SpreadSheetVariableRowIterator
      adams.flow.control.Tee -name progress
       adams.flow.transformer.IncVariable -var-name count -output-variable-value true
       adams.flow.sink.CallableSink -callable ProgressBar
      adams.flow.control.ClearCallableDisplay -name "clear transcript" -callable Transcript
      adams.flow.control.CloseCallableDisplay -name "close transcript" -callable Transcript
      adams.flow.control.Trigger -name "show transcript"
       adams.flow.source.Variable -var-name transcript -conversion adams.data.conversion.StringToString
       adams.flow.sink.CallableSink -callable Transcript
      adams.flow.control.Trigger -name "retrieve and playback file"
       adams.flow.standalone.SetVariable -var-name output_file -var-value ${TMP}/@{file} -value-type FILE_FORWARD_SLASHES -expand-value true
       adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
       adams.flow.transformer.UFDLTransformer -action "adams.flow.transformer.ufdl.GetSpeechFile -name @{file} -output-file @{output_file}" -use-error-queue true
       adams.flow.control.Trigger -name playback
        adams.flow.source.Variable -var-name output_file -conversion adams.data.conversion.StringToString
        adams.flow.sink.AudioPlayback
      adams.flow.transformer.SetVariable -name "reset (2)" -var-name show_files -var-value false
      adams.flow.control.CloseCallableDisplay -name "close transcript (2)" -callable Transcript
      adams.flow.control.ConditionalSubProcess -name continue? -condition "adams.flow.condition.bool.Expression -expression \"@{count} < @{max}\""
       adams.flow.transformer.ConfirmationDialog -message "Continue with playing back files?"
       adams.flow.transformer.SetVariable -name "set (2)" -var-name show_files -var-value true
    adams.flow.control.ClearCallableDisplay -name "clear transcript" -callable Transcript
    adams.flow.control.CloseCallableDisplay -name "close transcript" -callable Transcript
   adams.flow.control.Trigger -name Download
    adams.flow.source.Start
    adams.flow.control.Trigger -name "prompt user"
     adams.flow.standalone.SetVariable -name "restore file" -var-name restore -var-value @{flow_filename_long}-download.props -value-type FILE_FORWARD_SLASHES -expand-value true
     adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
     adams.flow.source.EnterManyValues -name "Download dataset" -value "adams.flow.source.valuedefinition.UFDLSpeechDatasetList -name dataset -display Dataset" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name parameters -display Parameters -help \"parameters for the wai.annotations library to customize the download\"" -value "adams.flow.source.valuedefinition.FileValueDefinition -name output_file -display \"Output file\" -help \"The file to save the downloaded dataset in.\" -file-chooser-title \"Select output file\" -extension zip -extension tar.gz -use-forward-slashes true" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name display_in_filebrowser -display \"Display in file browser?\" -type BOOLEAN -default-value false" -output-type MAP -restoration-enabled true -restoration-file @{restore}
     adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
     adams.flow.transformer.MapToVariables
     adams.flow.transformer.UFDLExtractAndTransfer -name dataset_pk -source dataset -target dataset_pk
    adams.flow.control.Block -name "block if cancelled" -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
    adams.flow.control.Trigger -name download
     adams.flow.source.Variable -var-name dataset_pk -conversion adams.data.conversion.StringToInt
     adams.flow.sink.UFDLSink -action "adams.flow.sink.ufdl.DownloadSpeechDataset -parameters @{parameters} -output-file @{output_file}" -use-error-queue true
    adams.flow.control.ConditionalTrigger -name display? -condition "adams.flow.condition.bool.VariableFlagSet -variable-name display_in_filebrowser"
     adams.flow.source.Variable -var-name output_file -conversion adams.data.conversion.StringToString
     adams.flow.sink.FileBrowser
   adams.flow.control.Trigger -name Delete
    adams.flow.source.Start
    adams.flow.control.Trigger -name "select datasets"
     adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
     adams.flow.source.EnterManyValues -value "adams.flow.source.valuedefinition.UFDLSpeechDatasetChooser -name datasets -display Datasets -multi-selection true -state ANY" -value "adams.flow.source.valuedefinition.DefaultValueDefinition -name hard_delete -display \"Hard delete?\" -type BOOLEAN -default-value false" -output-type MAP
     adams.flow.transformer.MapToVariables
     adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
     adams.flow.transformer.UFDLExtractAndTransfer -source datasets -target datasets_pk
    adams.flow.control.Block -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
    adams.flow.control.Trigger -name delete
     adams.flow.source.StringConstants -output-array true -string @{datasets_pk} -conversion adams.data.conversion.StringToInt
     adams.flow.control.Tee -name "# datasets"
      adams.flow.transformer.ArrayLength
      adams.flow.transformer.SetVariable -var-name num_items
     adams.flow.control.ConditionalTee -name delete? -condition "adams.flow.condition.bool.PromptUser -message \"Do you want to delete @{num_items} dataset(s)?\""
      adams.flow.transformer.ArrayToSequence
      adams.flow.transformer.SetVariable -var-name pk
      adams.flow.control.Trigger -name delete
       adams.flow.source.Variable -var-name pk -conversion adams.data.conversion.StringToInt
       adams.flow.transformer.UFDLTransformer -action "adams.flow.transformer.ufdl.DeleteSpeechDataset -hard @{hard_delete}" -use-error-queue true
       adams.flow.transformer.SetVariable -var-name success
       adams.flow.control.Trigger -name info
        adams.flow.source.CombineVariables -expression "deleted dataset @{pk}: @{success}" -conversion adams.data.conversion.StringToString
        adams.flow.sink.CallableSink -callable Info
   adams.flow.control.Trigger -name Reinstate
    adams.flow.source.Start
    adams.flow.control.Trigger -name "any datasets to reinstate?"
     adams.flow.standalone.SetVariable -name reset -var-name num_items -var-value 0
     adams.flow.source.UFDLSource -action "adams.flow.source.ufdl.ListSpeechDatasets -state DELETED" -use-error-queue true
     adams.flow.transformer.SpreadSheetInfo
     adams.flow.transformer.SetVariable -name set -var-name num_items
    adams.flow.control.IfThenElse -condition "adams.flow.condition.bool.Expression -expression \"@{num_items} = 0\""
     adams.flow.control.Trigger -name then
      adams.flow.source.CombineVariables -expression "No datasets available that can be reinstated!" -conversion adams.data.conversion.StringToString
      adams.flow.sink.InformationDialog -title "Reinstating users"
     adams.flow.control.Sequence -name else
      adams.flow.control.Trigger -name "select datasets"
       adams.flow.standalone.SetVariable -name reset -var-name cancelled -var-value true
       adams.flow.source.EnterManyValues -value "adams.flow.source.valuedefinition.UFDLSpeechDatasetChooser -name datasets -display Datasets -multi-selection true -state DELETED" -output-type MAP
       adams.flow.transformer.MapToVariables
       adams.flow.transformer.SetVariable -name set -var-name cancelled -var-value false
       adams.flow.transformer.UFDLExtractAndTransfer -source datasets -target datasets_pk
      adams.flow.control.Block -condition "adams.flow.condition.bool.VariableFlagSet -variable-name cancelled"
      adams.flow.control.Trigger -name reinstate
       adams.flow.source.StringConstants -output-array true -string @{datasets_pk} -conversion adams.data.conversion.StringToInt
       adams.flow.control.Tee -name "# datasets"
        adams.flow.transformer.ArrayLength
        adams.flow.transformer.SetVariable -var-name num_items
       adams.flow.control.ConditionalTee -name reinstate? -condition "adams.flow.condition.bool.PromptUser -message \"Do you want to reinstate @{num_items} dataset(s)?\""
        adams.flow.transformer.ArrayToSequence
        adams.flow.transformer.SetVariable -var-name pk
        adams.flow.control.Trigger -name reinstate
         adams.flow.source.Variable -var-name pk -conversion adams.data.conversion.StringToInt
         adams.flow.transformer.UFDLTransformer -action adams.flow.transformer.ufdl.ReinstateSpeechDataset -use-error-queue true
         adams.flow.transformer.SetVariable -var-name success
         adams.flow.control.Trigger -name info
          adams.flow.source.CombineVariables -expression "reinstated dataset @{pk}: @{success}" -conversion adams.data.conversion.StringToString
          adams.flow.sink.CallableSink -callable Info
   adams.flow.control.Tee -name "Clear output"
    adams.flow.transformer.CallableTransformer -callable "clear output"
   adams.flow.control.Tee -name Exit
    adams.flow.control.Stop